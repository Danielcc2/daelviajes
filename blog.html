<!DOCTYPE html>
<html lang="es">
<head>
  <title>Blog — DAEL Viajes</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="color-scheme" content="dark only" />
  <link rel="preload" href="assets/css/estilos.css" as="style">
  <link rel="stylesheet" href="assets/css/estilos.css" />
  <script type="module" src="assets/js/main.js" defer></script>
  <script type="module" src="assets/js/auth.js" defer></script>

</head>
<body>
  <header class="header-principal">
    <div class="contenedor header-contenido">
      <a class="logo-link" href="index.html" aria-label="Ir al inicio">
        <img src="assets/images/logo.png" alt="DAEL Viajes" class="logo" onerror="this.onerror=null;this.src='assets/images/logo.svg'" />
      </a>
      <nav class="nav-principal" aria-label="Principal">
        <ul>
          <li><a href="index.html">Inicio</a></li>
          <li><a href="blog.html">Blog</a></li>
          <li><a href="itinerarios.html">Itinerarios</a></li>
          <li><a href="guias.html">Guías</a></li>
          <li><a href="reseñas.html">Reseñas</a></li>
          <li><a href="consejos.html">Consejos</a></li>
          <li><a href="sobre.html">Sobre mí</a></li>
          <li><a href="contacto.html">Contacto</a></li>
          <li class="nav-cta"><a href="usuario/perfil.html" id="navCuenta">Mi cuenta</a></li>
        </ul>
      </nav>
      <button class="btn-hamburguer" aria-expanded="false" aria-controls="menu-movil" aria-label="Abrir menú" id="btnHamburguer">☰</button>
    </div>
    <nav id="menu-movil" class="menu-movil" hidden>
      <a href="index.html">Inicio</a>
      <a href="blog.html">Blog</a>
      <a href="itinerarios.html">Itinerarios</a>
      <a href="guias.html">Guías</a>
      <a href="reseñas.html">Reseñas</a>
      <a href="consejos.html">Consejos</a>
      <a href="sobre.html">Sobre mí</a>
      <a href="contacto.html">Contacto</a>
      <a href="usuario/perfil.html">Mi cuenta</a>
    </nav>
  </header>

<main class="contenedor">
  <h1>Blog de viajes</h1>
  <div class="filtros">
    <div class="searchbox">
      <input id="q" placeholder="Buscar artículos..." autocomplete="off" />
      <div id="sugWrap" class="sug-wrap" hidden>
        <ul id="sugList" class="sug-list"></ul>
      </div>
    </div>
    <select id="categoria">
      <option value="">Todas las categorías</option>
      <option>Guías</option>
      <option>Itinerarios</option>
      <option>Reseñas</option>
      <option>Consejos</option>
    </select>
    <button id="btnBuscar" class="btn btn-secundario">Buscar</button>
  </div>
  <div id="listBlog" class="grid-articulos"></div>
</main>
  <footer class="footer">
    <div class="contenedor footer-contenido">
      <p>&copy; 2025 DAEL Viajes — Blog de viajes, guías y experiencias.</p>
      <nav class="nav-secundario" aria-label="Secundario">
        <a href="sobre.html">Sobre mí</a>
        <a href="contacto.html">Contacto</a>
        <a href="privacidad.html">Privacidad</a>
        <a href="cookies.html">Cookies</a>
        <a href="#" id="btnSalir" class="link-sutil">Cerrar sesión</a>
      </nav>
    </div>
  </footer>
  <script src="assets/js/cookies.js" defer></script>

<script type="module">
  import { buscarPosts } from './assets/js/main.js';
  import { supabase } from './config/supabase.js';
  document.getElementById('btnBuscar').addEventListener('click',() => {
    buscarPosts(document.getElementById('q').value, document.getElementById('categoria').value);
  });
  buscarPosts();

  // Autocompletado de búsqueda
  const q = document.getElementById('q');
  const sugWrap = document.getElementById('sugWrap');
  const sugList = document.getElementById('sugList');
  let t = null;
  async function sugerir(v){
    if (!v || v.trim().length < 2){ sugWrap.setAttribute('hidden',''); sugList.innerHTML=''; return; }
    const { data } = await supabase.from('posts').select('slug,titulo').eq('publicado', true).ilike('titulo', `%${v}%`).order('fecha_pub',{ascending:false}).limit(6);
    sugList.innerHTML = '';
    (data||[]).forEach(p => {
      const li = document.createElement('li'); li.className='sug-item';
      li.innerHTML = `<span class="sug-title">${p.titulo}</span>`;
      li.addEventListener('click', () => { q.value = p.titulo; sugerir(''); buscarPosts(p.titulo, document.getElementById('categoria').value); });
      sugList.appendChild(li);
    });
    if ((data||[]).length>0) sugWrap.removeAttribute('hidden'); else sugWrap.setAttribute('hidden','');
  }
  q.addEventListener('input', () => { clearTimeout(t); t = setTimeout(()=>sugerir(q.value), 200); });
  q.addEventListener('focus', () => { if (sugList.children.length>0) sugWrap.removeAttribute('hidden'); });
  q.addEventListener('blur', () => setTimeout(()=>sugWrap.setAttribute('hidden',''), 150));
</script>
</body>
</html>
